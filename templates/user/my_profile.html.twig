{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}
    <div class="container-fluid myProfileView">
        <input type="hidden" class="userId" value="{{ user.id }}">
        <div class="row">
            <div class="col-4" style="border-right: 2px solid lightgray">
                <div class="profileData mt-3">
                    <div style="background-image: url({{ user.profilePicture }})" class="profileImageHolder" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ></div>
                    <div class="profileImageDropdown dropdown-menu">
                        <a class="dropdown-item viewImage" data-url="{{ user.profilePicture }}" href="#" data-toggle="modal" data-target="#viewPictureModal">View image</a>
                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#editProfilePictureModal">Select new image</a>
                        <a class="dropdown-item"><label for="uploadProfilePicture">Upload new image</label></a>
                        <form class="d-none" action="{{ path('upload_profile_picture') }}" method="post" enctype="multipart/form-data">
                            <input id="uploadProfilePicture" class="uploadButton" accept='image/*' type="file" name="files[]" onchange="submit()">
                        </form>
                    </div>
                    <div data-toggle="modal" data-target="#editProfileDataModal"><img src="https://cdn4.iconfinder.com/data/icons/design-4/100/14-512.png" alt="" style="width: 30px;float: right"></div>
{#                    Hi, i am {{ user.fullName }}, a zanimanje form {{ user.countryAndCity }}. I'm have #}
                    <table class="table table-bordered table-light basicInfoTable">
                        <tr>
                            <td class="pr-5">Name:</td>
                            <td><b>{{ user.fullName }}</b></td>
                        </tr>
                        <tr>
                            <td class="pr-5">Email:</td>
                            <td><b>{{ user.email }}</b></td>
                        </tr>
                        <tr>
                            <td class="pr-5">Birthday:</td>
                            <td><b>{{ user.dateOfBirth|date('d. m. Y.') }}</b></td>
                        </tr>
                        <tr>
                            <td class="pr-5">From:</td>
                            <td><b>{{ user.countryAndCity }}</b></td>
                        </tr>
                    </table>
                    <p class="mt-4 mb-4">{{ user.additionalInformation }}</p>
                    <a href="{{ path('get_all_pictures', {user: user.id}) }}">See full gallery</a>
                    <div class="row sideGallery">
                        {% for image in user.files %}
                            {% if loop.index < 16 %}
                                <div class="col-4 mb-4">
                                    <img src="{{ image.url }}" class="img-fluid" style="max-height: 180px">
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-8">
                <h1 class="text-center">Posts</h1>
                <div class="newPost">
                    <form action="{{ path('post_new') }}" class="postClass" method="post" enctype="multipart/form-data">
                        <textarea style="height: 150px" class="form-control" placeholder="Type new post..." name="newPost" id="newPost" rows="200" maxlength="255"></textarea>
                        <label for="uploadMedia" class="btn btn-primary m-1">Upload media <i class="fa fa-image"></i></label>
                        <input id="uploadMedia" class="images d-none"type="file" accept='image/*' name="files[]" multiple="multiple">
                        <button type="submit" class="btn btn-primary float-right m-1" value="submit">Publish</button>
                    </form>
                </div>
                <div class="myPosts">
                    {% for post in allPosts|reverse %}
                        <div class="postAndComment m-0 mb-5">
                            <span><b>{{ post.user.fullname }}</b></span> in <span><b>{{ post.dateAndTime }}</b></span>
                            <div class="postText">
                                <p>{{ post.text }}</p>
                            </div>
                            {% if post.files|length == 1 %}
                                <img src="{{ asset(post.files[0].url) }}" alt="" data-url="{{ post.files[0].url }}" class="img-fluid center" data-toggle="modal" data-target="#viewPictureModal">
                            {% elseif post.files|length > 1 %}
                                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                                    <ol class="carousel-indicators">
                                        {% for image in post.files %}
                                            <li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index-1 }}" class="{% if loop.index == 1 %} active {% endif %}"></li>
                                        {% endfor %}
                                    </ol>
                                    <div class="carousel-inner">
                                        {% for image in post.files %}
                                            <div class="carousel-item {% if loop.index == 1 %} active {% endif %}" style="max-height: 380px">
                                                <img class="d-block w-100 img-fluid" src="{{ asset(image.url) }}" alt="{{ loop.index }} slide" data-url="{{ image.url }}" data-toggle="modal" data-target="#viewPictureModal">
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                            {% endif %}
                            {{ render(controller('App\\Controller\\DefaultController::getComments', {post: post})) }}
                            <form action="{{ path('leave_comment', {postId: post.id}) }}" method="post">
                                <textarea name="commentInputField" id="commentInputField" class="commentInputField" placeholder="Leave a comment..."></textarea>
                                <button type="submit" class="commentButton float-right">Comment</button>
                            </form>
                        </div>
                        {{ render(controller('App\\Controller\\DefaultController::getViewPictureModal', {post: post})) }}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="editProfilePictureModal" tabindex="-1" role="dialog" aria-labelledby="editProfilePictureModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content editProfilePictureDialog">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Selec image from gallery</h5>
                </div>
                <div class="modal-body">
                    <div class="row align-items-center">
                        {% for image in user.files %}
                            <div class="col-3">
                                <img src="{{ image.url }}" class="img-fluid selectedImage" data-id="{{ image.id }}">
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <form action="{{ path('change_photo', {user: user.id}) }}" method="post">
                        <input type="hidden" name="selectedImageId" class="selectedImageId">
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileDataModal" tabindex="-1" role="dialog" aria-labelledby="editProfileDataModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h5 class="modal-title" id="exampleModalLabel">Edit profile data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-2"></div>
                        <div class="col-8 m-0">
                            {{ form_start(editUserForm, {'action': path('editProfileData', {user: user.id}), 'method': 'POST'}) }}
                            {{ form_end(editUserForm) }}
                        </div>
                        <div class="col-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
